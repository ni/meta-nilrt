From 6c11bab864db5c94dc4987770b4b7f5994cdc2af Mon Sep 17 00:00:00 2001
From: jonyhy96 <hy352144278@gmail.com>
Date: Thu, 10 Mar 2022 10:41:48 +0800
Subject: [PATCH] fix: jinja2 contextfuntion base on version

(cherry picked from commit 2c39d8626527d1d753f5447753855bc7e265874b)
Signed-off-by: Alex Stewart <alex.stewart@ni.com>

Upstream-Status: Inappropriate [Upstream stable EOL.]
---
 salt/utils/jinja.py | 6 +++++-
 1 file changed, 5 insertions(+), 1 deletion(-)

diff --git a/salt/utils/jinja.py b/salt/utils/jinja.py
index 40bfb21bd2..52a59da2d7 100644
--- a/salt/utils/jinja.py
+++ b/salt/utils/jinja.py
@@ -659,7 +659,11 @@ def symmetric_difference(lst1, lst2):
     return unique([ele for ele in union(lst1, lst2) if ele not in intersect(lst1, lst2)])
 
 
-@jinja2.contextfunction
+if jinja2.__version__ < '3.0.0' :
+    contextfunction = jinja2.contextfunction
+else:
+    contextfunction =  jinja2.pass_context
+@contextfunction
 def show_full_context(ctx):
     return salt.utils.data.simple_types_filter({key: value for key, value in ctx.items()})
 
